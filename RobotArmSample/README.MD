# Описание примера бизнесс-процесса в нотации BPMN (Cammunda).


##1. Проверка оборудования (отклик).
Проверка связи с модулями. При этом исключение [noConnectionError] может не происходить при
одсутствии манипуляторов (в этом случае можно вызвать человека для выполнения операции).
##2. Ожидание команды запуска.
Процесс перейдёт к следующему блоку только после получения команды запуска. Получить её
можно посредством подачи сигнала через Camunda панель задач или программы клиента для
смартфона (MQTT клиента).
##3. Выбор исполнителя.
Для выполнения задачи выбирается один из свободных роботов-манипуляторов (РМ). При отсутствии 
свободного РМ выдаётся исключение [unavailableError].
##4. Выполнение операции (нажать кнопку посредством доступного РМ или вручную).
РМ подаётся сигнал для выполения операции (нажать на кнопку, отжать её и вернуться в 
исходное положение). Если прошлым блоком выло выдано исключение [unavailableError], 
то на Camunda панель задач подаётся уведомление "Нажать кнопку вручную" 
##5. Проверка результата.
Кнопка опрашивается, была ли нажатие. При отсутствия нажатия отправляется уведомление 
на ремонт датчика и программа завершается.
##6. Отправка статуса выполнения
В Camunda панель задач или клиент для смартфона отправляется уведомление об успешном 
выполнении цикла. 
##7. Переход к началу цикла (шаг 1)

### *Завершить процесс можно в любой момент, отправив команду завершения через клиент для смартфона или Camunda панель задач.


# Описание Универсального коннектора.
Для обмена информацией используется определённый вид данных в формате XML:
```
<Module>
   <Name>moduleName</Name>
    <ModuleType>moduleTypeNumber</ModuleType>
    <UID>UIDnumber</UID>
    <Status>1</Status>
    <Data>
        <Task>
            <Program>programNumber</Program>
        </Task>
        <Request>status</Request>
        <Report>reportMessage</Report>
        <WorkMode>mode</WorkMode>
        <Slot> 
            <Status>
        </Slot>
    </Data>  
</Module>
```
Все устройства подписаны на один и тот же общий топик для и отправляют сообщения в один и тот же общий топик, не совпадающий с топиком подписки.

## Обработка сообщений
Устройство принимает сообщения с топика подписки. Далее собщение проверяется по предназначению

- Предназначено ли сообщение для устройств всех типов
- - Предназначено ли сообщение для всех устройств (Name: all)
- - - считывание запроса Request из Data
    
На запрос status или нераспознаный запрос отправить статус устройства (имя, тип, статус).
- Предназначено ли сообщение для устройств собственного типа
- - Предназначено ли сообщение для всех устройств (Name: all)
- - - считывание запроса Request из Data
      
На запрос status или нераспознаный запрос отправить статус устройства (имя, тип, статус).
- - Предназначено ли сообщение для данного устройства (Name: moduleName)
- - - считывание запроса Request из Data
      
На запрос status отправить статус устройства (имя, тип, статус).
На запрос конкретных распознаных данных отправить эти данные
- - - считывание запроса Task из Data
    
Выполнить распознаную задачу
- - - считывание запроса Report из Data 
      
Обработать полученный ответ

### Обозначения
Status:
* 0 - работает, ожидание команды
* 1 - работает, в процессе выполнения команды
* 2 - имеются неполадки
* 3 - имеются неполадки, вывод информации об ошибке в Report в Data

ModuleType:
* 0 - machineTool (станок)
* 1 - RobotArm (манипулятор)
* 2 - Modules (датчики, конвееры, всё остальное)

Data - контекст с принимаемыми данными

Task - задача для выподнения устройством :
* Program - номер программы

Request - для запроса параметров и данных (например status)

Report - сообшение от устройства, отчёт об ошибке




требование к протоколу передачи данных

сравнивая с ModBus

гарантированная доставка
работа в mash сетях 